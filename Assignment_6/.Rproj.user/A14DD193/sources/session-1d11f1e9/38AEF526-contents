# Load the necessary libraries
library(tidyverse)
library(gganimate)

# Read the data
dat <- read_csv("C:/Users/Rushe/Desktop/Data_Course_EUAN/Data/BioLog_Plate_Data.csv")

# Transform the data into a long format
dat_long <- dat %>%
  pivot_longer(cols = c("Hr_24", "Hr_48", "Hr_144"),
               names_to = "time",
               values_to = "absorbance")

# Add a new column to classify the sample type
dat_long <- dat_long %>%
  mutate(sample_type = case_when(
    str_detect(`Sample ID`, "Soil_1") ~ "Soil_1",
    str_detect(`Sample ID`, "Soil_2") ~ "Soil_2",
    str_detect(`Sample ID`, "Clear_Creek") ~ "Clear_Creek",
    str_detect(`Sample ID`, "Waste_Water") ~ "Waste_Water"
  ))

# Filter the data for a dilution of 0 and substrate "Itaconic Acid"
dat_filtered <- dat_long %>%
  filter(Dilution == 0, Substrate == "Itaconic Acid")

# Calculate mean absorbance values for each group
dat_mean <- dat_filtered %>%
  group_by(time, sample_type) %>%
  summarise(mean_absorbance = mean(absorbance))

# Convert 'time' to numeric
dat_mean$time <- as.numeric(gsub("Hr_", "", dat_mean$time))

# Generate the plot
ggplot(dat_mean, aes(x = time, y = mean_absorbance, color = sample_type)) +
  geom_line() +
  facet_wrap(. ~ sample_type) + # Add this line to your code
  labs(x = "Time (hours)", y = "Mean Absorbance", color = "Sample Type") +
  theme_minimal()


#checking 
# Check if 'sample_type' exists in 'dat_mean'
"sample_type" %in% colnames(dat_mean)

# Check the number of unique values in 'sample_type'
length(unique(dat_mean$sample_type))

# checking 
# Check if 'time' exists in 'dat_mean'
"time" %in% colnames(dat_mean)

# Check the number of unique values in 'time'
length(unique(dat_mean$time))

# Check if 'mean_absorbance' exists in 'dat_mean'
"mean_absorbance" %in% colnames(dat_mean)

# Check the number of unique values in 'mean_absorbance'
length(unique(dat_mean$mean_absorbance))



# okayyyy so now you can check it 
# Calculate mean absorbance values for each group and complete missing combinations
dat_mean <- dat_filtered %>%
  group_by(time, sample_type) %>%
  summarise(mean_absorbance = mean(absorbance), .groups = "drop") %>%
  complete(time, sample_type, fill = list(mean_absorbance = NA))

# Now try the plot again
ggplot(dat_mean, aes(x = time, y = mean_absorbance, color = sample_type)) +
  geom_line() +
  facet_wrap(. ~ sample_type) +
  labs(x = "Time (hours)", y = "Mean Absorbance", color = "Sample Type") +
  theme_minimal()

